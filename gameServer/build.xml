<?xml version="1.0" encoding="GBK"?>
<project name="gameServer" default="zip" basedir=".">
	<!-- ���������jar�� -->
	<property name="ant-contrib.jar" location="../common/lib/ant-contrib-1.0b3.jar" />
	<taskdef resource="net/sf/antcontrib/antcontrib.properties" classpath="${ant-contrib.jar}" />
	<!-- ����·�� -->
	<property name="build.dir" location="build" />
	<property name="src.dir" location="build/src" />
	<property name="bconf.dir" location="build/conf" />
	<property name="classes.dir" value="build/classes" />
	<property name="tolib.dir" value="build/lib"/>
	<property name="common.dir" location="../common"/>
	<property name="lib.dir" location="../common/lib"/>
	<property name="commdef.dir" location="../commdef"/>
	<property name="conf.dir" location="conf"/>
	<property name="robots.dir" location="robots.txt"/>
	<!-- ���·�ںʹ���ļ�-->
	<property name="main-class" value="core.server.GameServer"/>
	<property name="jar.file" value="build/gameServer.jar"/>
	<!-- ����Ϸ�б� -->
	<property name="game-list"
			  value="DZPK,NN,PDK,QZMJ,SSS"/>
	<path id="classpath">
		<fileset dir="${lib.dir}">
			<include name="**/*.jar"/>
		</fileset>
	</path>
	<target name="clean" description="��������">
		<delete dir="${build.dir}"/>
		<echo level="info">������ʼ</echo>
	</target>
	<!-- ѭ����������Ϸ����Ŀ¼ -->
	<target name="copyGame">
		<echo>${game}</echo>
		<copy todir="${src.dir}">
			<fileset dir="../${game}/src">
				<include name="**/*.java" />
			</fileset>
		</copy>
	</target>
	<!-- ��������jar����common��commdef����������,����Ϸ����Ŀ¼�ı���Ŀ¼build-->
	<target name="init" depends="clean" description="��ʼ��,����Ŀ¼,�����ļ�">
		<mkdir dir="${build.dir}"/>
		<mkdir dir="${classes.dir}"/>
		<mkdir dir="${src.dir}"/>
		<copy todir="${src.dir}">
			<fileset dir=".">
				<include name="**/*.java" />
			</fileset>
		</copy>
		<copy todir="${src.dir}">
			<fileset dir="${commdef.dir}/src">
				<include name="**/*.java" />
			</fileset>
		</copy>
		<copy todir="${src.dir}">
			<fileset dir="${common.dir}/src">
				<include name="**/*.java" />
			</fileset>
		</copy>
		<!--��������Ϸ����Ŀ¼ -->
		<foreach list="${game-list}" target="copyGame" param="game" delimiter=",">
		</foreach>

		<copy todir="${bconf.dir}">
			<fileset dir="${conf.dir}"/>
		</copy>
		<copy file="${robots.dir}" todir="${build.dir}"/>
		<echo level="info">ǰ�ڴ����������</echo>
	</target>
	<!-- ������Ŀ¼��build-->
	<target name="compile" depends="init" description="����">
		<javac includeantruntime="on" srcdir="${src.dir}" destdir="${classes.dir}" classpathref="classpath" source="1.8" target="1.8"  verbose="no" failonerror="on" debug="true" fork="true" memoryMaximumSize="9216m">
			<compilerarg line="-encoding UTF-8 "/>
		</javac>
		<echo level="info">�������</echo>
	</target>
	<!-- �������class�ļ���jar��-->
	<target name="jar" depends="compile" description="������ļ�">
		<!-- ��������jar����lib���棬����gameSever.jar���ļ���С-->
		<pathconvert property="mf.classpath" pathsep=" ">
			<mapper>
				<chainedmapper>
					<flattenmapper />
					<globmapper from="*" to="lib/*" />
				</chainedmapper>
			</mapper>
			<path refid="classpath" />
		</pathconvert>
		<!-- ���gameServer.jar-->
		<jar jarfile="${jar.file}" zip64mode="as-needed">
			<fileset dir="${classes.dir}" includes="**/*.*" />
			<manifest>
				<attribute name="Main-Class" value="${main-class}"/>
				<attribute name="Class-Path" value="${mf.classpath}"/>
			</manifest>
		</jar>
		<!-- ��������build/lib-->
		<copy todir="${tolib.dir}" flatten="true">
			<fileset dir="${lib.dir}">
				<include name="**/*.jar" />
				<type type="file"/>
			</fileset>
		</copy>
		<echo level="info">������</echo>
	</target>
	<!-- ������Ŀ¼��build���µ�src��classes-->
	<target name="end" depends="jar" description="����,ɾ����ʱĿ¼">
		<delete dir="${classes.dir}" />
		<delete dir="${src.dir}" />
		<echo level="info">�������</echo>
	</target>
	<!-- ����zip -->
	<target name="zip" depends="end" description="ѹ��lib����Ϸ�Լ�����">
		<!-- ����zip -->
		<zip basedir="${build.dir}/conf" zipfile="${build.dir}/conf.zip"/>
		<zip basedir="${build.dir}/lib" zipfile="${build.dir}/lib.zip"/>
		<delete dir="${build.dir}/conf"/>
		<delete dir="${build.dir}/lib"/>
		<echo level="info">ѹ��lib����Ϸ�Լ��������</echo>
	</target>

	<!--target name="run" depends="compile" description="����">
        <java classname="powerwind.Sample" fork="yes" dir="${basedir}">
            <classpath refid="run.classpath" />
            <arg line="1" />
        </java>
    </target-->
</project>